{
    "language": "javascript",
    "validate_doc_update": "
function validate_doc_update(newDoc, oldDoc, userCtx, secObj) {
    var required_keys = ['owner', 'renderer', 'content', 'lasted', 'created', 'subject', 'threadid', 'signature'];
    if (oldDoc !== null) {
        if (newDoc.created !== oldDoc.created) {
            throw {forbidden: 'Attempted to change post created'};
        }
    }
    if (isNaN(Date.parse(newDoc.created))) {
        throw {forbidden: 'Created date is not a date'};
    }
    if (isNaN(Date.parse(newDoc.lasted))) {
        throw {forbidden: 'Last edited is not a date'};
    }
    required_keys.forEach(function(key) {
        if (!key in newDoc) {
            throw {forbidden: 'Missing ' + key};
        }
    });
    return true;
}
    ",
    "updates": {
        "post": "function post(doc, req) {
var now,
    newDoc = req.form;
log(doc);
log(newDoc);
return [doc, 'Edited'];
}"
    },
    "views":
    {
        "thread": {
            "map": "function(doc) { emit([doc.threadid, doc.created]); }"
        }
    }
}
